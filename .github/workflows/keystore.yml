name: PREVISION CI

on:
  pull_request:
    branches: [ main ]  # Trigger for PRs to main branch

jobs:
  ios_build:
    runs-on: macOS-latest
    steps:
     - name: Set up ruby env
       uses: ruby/setup-ruby@v1
       with:
         ruby-version: 3.2.2
         bundler-cache: true
     - name: Select Xcode
       run: sudo Xcode-select -switch /Applications/Xcode_14.2.app/Contents/Developer
     - name: Build
       run: xcodebuild clean build -workspace NavigatorApp.xcworkspace -scheme <Your_proj_scheme> -destination 'platform=iOS Simulator,name=iPhone 14 Pro example,OS=16.2'
     - name: upload iOS binary
       uses: maierj/fastlane-action@v1.4.0
       with:
        lane: bundle exec fastlane ios upload_ios_beta_Testflight
       env:
         APPLE_ID: '${{ secrets.APPLE_ID }}'
         IOS_IDENTIFIER: '${{ secrets.IOS_IDENTIFIER }}'
         TEAM_ID: '${{ secrets.TEAM_ID }}'
         FASTLANE_APPLE_ID: '${{ secrets.FASTLANE_APPLE_ID }}'
         FASTLANE_APPLE_APPLICATION_SPECIFIC_PASSWORD: '${{ secrets.FASTLANE_APPLE_APPLICATION_SPECIFIC_PASSWORD }}'
         MATCH_PASSWORD: '${{ secrets.MATCH_PASSWORD }}'
         GIT_AUTHORIZATION: '${{ secrets.GIT_AUTHORIZATION }}'